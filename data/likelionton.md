일단 나와 - 멋쟁이사자 중앙헤커톤

외출 루틴을 돕는 react native 모바일 앱

- react native 기반의 크로스플랫폼 모바일 서비스로, 사용자의 위치 정보, 카메라, 알림 권한을 활용해 일상적인 외출 루틴을 돕는 앱입니다.

- 팀명 : 독수리 오형제
- 진행 기간 : 2024.07 ~ 2024.08
- 멤버 : fe 2, be 2, de 1

기술 스택
javascript
react-native
expo
reactContextAPI

핵심 아이디어

- 위치 권한을 통해 현재 위치 기반의 주변 정보를 제공
- 카메라 권한을 통해 외출 인증 사진을 남김
- 알림 권한을 통해 하루 한번 외출을 리마인드하는 것을 목표

내 역할 :

- 온보딩 플로우, 전체 구현과 관련 훅/컴포넌트 연동 담당
- 구글 OAuth 로그인

내가 기여한 기능

1. 약관 동의 / 권한 허용 화면 전체 설계 및 구현

- UI/UX 설계
  - '위치','카메라','알림' 세가지 필수 권한을 한 화면에서 직관적으로 관리할 수 있도록 권한별 카드 컴포넌트 PermissionContent를 설계
- 상태관리 및 UX 제어
  - locationAgree, cameraAgree, notificationAgree 세 개의 상태를 두고, allPermissionsGranted = (locationAgree && cameraAgree) || notificationAgree 조건을 통해 위치 + 카메라 필수 허용, 알림 권한 허용에 다음 단계로 진행 할 수 있도록 비즈니스 로직을 구성

2. 구글 OAuth 기반의 소셜 로그인

- 앱 내 딥링크 방식으로 구현해, 브라우저에서 인증 완료 후 자동으로 앱으로 복귀하고 토큰을 처리하는 플로우를 구축
- 사용자가 외부 브라우저에서 구글 계정 인증을 완료하면, 등록한 딥링크 스킴으로 앱이 다시 열리도록 구성하고, 딥링크에 포함된 인가 코드를 파싱해 액세스 토큰을 발급/검증한 뒤, 신규 유저는 회원가입 처리, 기존 유저는 자동 로그인이 되도록 전체 플로우를 설계/구현 했습니다.

트러블 슈팅
문제 상황

- 구글 OAuth 로그인/회원가입을 딥링크로 연동했는데,
  - 안드로이드에서는 인증 후 앱으로 잘 돌아오지만
  - iOS에서만 브라우저에서 인증 완료 후 앱이 열리지 않거나, 열려도 쿼리 파라미터가 비어 있는 현상이 발생했습니다.
- 결과적으로 인가 코드를 받지 못해, 토큰 발급 및 로그인 처리가 불가능한 상태

원인 분석 과정

- 처음에는 백엔드 콜백 URL 설정 문제라고 생각해서 redirect URL, origin, CORS 설정을 확인했지만, 서버 로그에는 콜백이 정상적으로 찍힘.
- 이후, iOS에서만 문제가 생기는 점을 바탕으로 딥링크/유니버셜 링크 설정을 집중적으로 확인
- 확인 결과
  - iOS Info.plist 에 등록한 URL Scheme 값과 실제 구글 OAuth 리다이렉트 URL의 스킴이 일치하지 않았고,
  - 딥링크를 처리하는 쪽에서 ://callback 뒤의 쿼리 파라미터 파싱 로직이 안드로이드 기준으로만 구현되어 있어 iOS에서 넘어오는 포맷을 제대로 처리하지 못하고 있었다.

해결 방법

- 먼저, 구글 콘솔과 서버에 등록된 리다이렉트 URL을 myapp://oauth/callback 형식으로 통일하고, iOS Info.plist의 URL Types에 동일한 스킴과 호스트를 등록해 플랫폼 간 일관성을 맞췄습니다.

- 그 다음, 앱에서 딥링크를 수신하는 부분에서
  - myapp://oauth/callback?code=...&state=... 형태의 URL을 기반으로
  - 쿼리 파라미터를 공통 유틸 함수로 파싱하도록 리팩터링하여, 안드로이드/iOS 모두 같은 로직을 타도록 정리했습니다.
- 마지막으로, 인가 코드 수신 후:
  - 백엔드에 인가 코드를 넘겨 access/refresh 토큰을 발급받고,
  - 서버에서 신규 유저 여부를 판단해 회원가입 또는 로그인 분기를 태우는 전체 플로우를 점검하여 문제를 검증했습니다.

느낀점
과거에는 Firebase의 구글 OAuth를 그대로 사용하면서 인증 과정을 깊게 고민하지 않았는데, 이번에는 백엔드와 redirect URL, 딥링크 스킴, 토큰 처리 방식을 함께 정의하며 구글 OAuth를 직접 구현해야 했고, 익숙한 SDK의존이 아닌, 딥링크/백엔드 연동/보안 흐름을 스스로 이해하고 설계해야 했다는 점이 어렵지만 가장 많이 성장한 경험이었습니다.
